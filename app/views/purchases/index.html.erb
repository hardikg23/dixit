<div class="container">
  <div class="row">
    <div class="col-md-12 primary">
      <div class="pad10 white--text font15">Purchases</div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6 text-left pad10">
      <%= link_to 'Home', root_path %> > Purchases
    </div>
    <div class="col-md-6 text-right">
      <%= link_to new_purchase_path do %>
        <button class="btn btn-success mar10" type="submit">Add New</button>
      <% end %>
    </div>
  </div>

  <table class="table table-striped table-bordered">
    <tr>
      <th>Date</th>
      <th>Party</th>
      <th>Carat</th>
      <th>Amount</th>
      <th>Total</th>
      <th>Total Paid</th>
      <th>Type</th>
      <th></th>
    </tr>

    <% @purchases && @purchases.each do |p| %>
      <tr>
        <td><%= p.payment_date.strftime("%d/%m/%y") %></td>
        <td>
          <b><span class="font12"><%= p.entity && p.entity.get_display_name %></span></b>
        </td>
        <td><%= p.quantity %></td>
        <td>
          <% if p.rupees? %>
            Rs <%= p.amount %>
          <% else %>
            $ <%= p.amount %> <br>
            <% if p.conversion_rate.present? %>
              (<%= p.conversion_rate %>)
            <% end %>
          <% end %>
        </td>
        <td>
          <% if p.rupees? %>
            <% total_amount = p.amount * p.quantity %>
          <% else %>
            <% total_amount = p.conversion_rate.present? ? (p.amount * p.quantity * p.conversion_rate) : 0 %>
          <% end %>
          &#8377;<%= number_with_delimiter(total_amount) %>
        </td>
        <td class="<%= total_amount <= p.total_paid ? 'success' : 'danger' %>">          
          &#8377;<%= number_with_delimiter(p.total_paid) %>
        </td>
        <td><%= p.get_payment_type %></td>
        <td>
          <%= link_to edit_purchase_path(p) do %>
            <button class="btn btn-info" type="submit">Edit</button>
          <% end %>
          <%= link_to purchase_path(p), method: :delete, data: { confirm: 'Are you sure?' } do %>
            <button class="btn btn-danger" type="submit">Delete</button>
          <% end %>
          <%= link_to new_payment_path(purchase_id: p.id) do %>
            <button class="btn btn-info" type="submit">Payments</button>
          <% end %>
        </td>
      </tr>
    <% end %>
  </table>

</div>